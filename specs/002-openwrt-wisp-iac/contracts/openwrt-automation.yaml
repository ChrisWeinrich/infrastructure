openapi: 3.0.3
info:
  title: OpenWrt WISP Automation Contract
  version: 0.1.0
  description: |
    Conceptual contract for snapshot, apply, verify, and drift operations used
    by the IaC workflow. This represents the expected inputs and outputs for
    automation actions rather than a public service API.
servers:
  - url: http://localhost
paths:
  /snapshots:
    post:
      summary: Capture a configuration snapshot
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SnapshotRequest"
      responses:
        "201":
          description: Snapshot created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SnapshotRecord"
  /apply:
    post:
      summary: Apply desired configuration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ApplyRequest"
      responses:
        "200":
          description: Apply completed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApplyResult"
  /verify:
    post:
      summary: Run verification checklist
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VerifyRequest"
      responses:
        "200":
          description: Verification results
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VerifyResult"
  /drift:
    get:
      summary: Get drift report
      parameters:
        - in: query
          name: router_id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Drift report
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DriftReport"
components:
  schemas:
    SnapshotRequest:
      type: object
      required: [router_id, config_files]
      properties:
        router_id:
          type: string
        config_files:
          type: array
          items:
            type: string
    SnapshotRecord:
      type: object
      properties:
        router_id:
          type: string
        captured_at:
          type: string
          format: date-time
        files:
          type: array
          items:
            type: string
    ApplyRequest:
      type: object
      required: [router_id, desired_version]
      properties:
        router_id:
          type: string
        desired_version:
          type: string
    ApplyResult:
      type: object
      properties:
        router_id:
          type: string
        desired_version:
          type: string
        changed:
          type: boolean
        completed_at:
          type: string
          format: date-time
    VerifyRequest:
      type: object
      required: [router_id, checklist_id]
      properties:
        router_id:
          type: string
        checklist_id:
          type: string
    VerifyResult:
      type: object
      properties:
        router_id:
          type: string
        checklist_id:
          type: string
        status:
          type: string
          enum: [pass, fail]
        details:
          type: string
    DriftReport:
      type: object
      properties:
        router_id:
          type: string
        compared_at:
          type: string
          format: date-time
        status:
          type: string
          enum: [clean, drifted]
        differences:
          type: array
          items:
            type: string
